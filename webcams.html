<!DOCTYPE html>
<html lang="en">
	<head>
	  <title>Webcams</title>
	  <meta charset="utf-8">
	  <meta name="viewport" content="width=device-width, initial-scale=1">
	  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
	  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">
	  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
	  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	  <script type="text/javascript" src="https://static.panomax.com/front/thumbnail/js/pmaxthumbnail.js"></script>
	  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
	  <script type="text/javascript">
			let timeText;
			
			const locationList = {
				"valleaosta": {
					name: "Valle d'Aosta", locations: {
						"cervinia" : { 
							name: "Cervinia", webcams: [ 
								{ name: "Plan Maison", type: "image", src: "https://cervinia-api.devtherocks.it/api/webcam/CEWC_AREA_PLANMAISON.jpg"},
								{ name: "Plan Maison", type: "iframe", iframeType: "panoramax", iframeId: 1203},
								{ name: "Plateau Rosa", type: "iframe", iframeType: "panoramax", iframeId: 1289},
								{ name: "Zermatt", type: "iframe", src:"https://zbag.roundshot.com/matterhornglacierparadise/#/video"},
								{ name: "Cretaz", type: "image", src: "https://cervinia-api.devtherocks.it/api/webcam/CEWC_AREA_CRETAZ.jpg"}, 
								{ name: "Du Col Monte", type: "image", src: "https://cervinia-api.devtherocks.it/api/webcam/CBWC_AREA_DUCOL_M.jpg"},
								{ name: "Goillet", type: "iframe", src: "https://webtv.feratel.com/webtv/?cam=6350&design=v5&lg=it"},
								{ name: "Valtournanche Motta", type: "image", src: "https://cervinia-api.devtherocks.it/api/webcam/CBWC_AREA_MOTTA_M.jpg"},
								{ name: "Chamois", type: "iframe", iframeType: "panoramax", iframeId: 1774},
							]},
						"pila" : {
							name: "Pila", webcams: [ 
								{ name: "Gorraz", type: "iframe", src: "https://webtv.feratel.com/webtv/?cam=6315&design=v5&lg=it"},
								{ name: "Chamole", type: "iframe", src: "https://webtv.feratel.com/webtv/?cam=6312&design=v5&lg=it"},
								{ name: "Couis1", type: "iframe", src: "https://webtv.feratel.com/webtv/?cam=6310&design=v5&lg=it"},
								{ name: "Grimod", type: "iframe", src: "https://webtv.feratel.com/webtv/?cam=6311&design=v5&lg=it"}
							]},
						"monterosa" : {
							name: "Monterosa", webcams: [ 
								{ name: "Crest", type: "iframe", src: "https://webtv.feratel.com/webtv/?cam=6284&design=v5&lg=it"},
								{ name: "Colle Betta", type: "iframe", src: "https://webtv.feratel.com/webtv/?cam=6283&design=v5&lg=it"},
								{ name: "Gabiet", type: "iframe", src: "https://webtv.feratel.com/webtv/?cam=6285&design=v5&lg=it"},
								{ name: "Sitten", type: "iframe", src: "https://webtv.feratel.com/webtv/?cam=6282&design=v5&lg=it"},
								{ name: "Salati", type: "image", src: "https://webcam.visitmonterosa.com/webcam.php?wid=4&ext=.jpg&timestamp=1704787583"}					
							]},
						"lathuile" : {
							name: "La Thuile", webcams: [ 
								{ name: "Paese", type: "iframe", src:"https://ac123mp-cdn.streamcloud.it/embed/live/8c52090f-320d-4ab9-9bcf-3e2fc5472d06"},
								{ name: "Chaz Dura", type: "iframe", src:"https://ac123mp-cdn.streamcloud.it/embed/live/f0675f54-ba1a-4745-9d5c-bf355b576d1a"},
								{ name: "Chaz Dura", type: "iframe", iframeType: "panoramax", iframeId: 1270},
								{ name: "Rosiere", type: "iframe", src:"https://m.webcam-hd.com/rosiere-planica/rosiere-planica_hotel"}
							]},
						"courmayeur" : {
							name: "Courmayeur", webcams: [ 
								{ name: "Courmayeur 360", type: "iframe", iframeType: "panoramax", iframeId: 4053485},
								{ name: "Punta Helbronner", type: "iframe", iframeType: "panoramax", iframeId: 1954},
								{ name: "Courmayeur", type: "iframe", src: "https://webtv.feratel.com/webtv/?cam=6358&design=v5&lg=it"},
							]}
				}},			
				"piemonte": {
					name: "Piemonte", locations: {	
						"vialattea" : {
							name: "Vialattea", webcams: [ 
								{ name: "Sestriere", type: "iframe", iframeType: "panoramax", iframeId: 1990340},
								{ name: "Banchetta", type: "iframe", iframeType: "panoramax", iframeId: 1863540},
								{ name: "Monte Fraiteve", type: "iframe", iframeType: "panoramax", iframeId: 1864650},
								{ name: "Sauze D'Oulx", type: "iframe", iframeType: "panoramax", iframeId: 1987154},
								{ name: "San Sicario", type: "iframe", iframeType: "panoramax", iframeId: 1868105}
							]},
						"mondole" : {
							name: "Mondol√®", webcams: [ 
								{ name: "Rosso", type: "iframe", iframeType: "panoramax", iframeId: 2640998},
								{ name: "Conca", type: "iframe", iframeType: "panoramax", iframeId: 4056147},
								{ name: "Conca", type: "image", src: "https://www.vigliettisport.com/webcam.jpg"},
								{ name: "Artesina", type: "hls", src: "http://vps-bc4b65e2.vps.ovh.net:1880/webcam/skyline?src=/italia/piemonte/cuneo/artesina-mondole-ski.html?w=88&referrer=https://www.artesina.it/"},
								{ name: "Turra", type: "hls", src: "http://vps-bc4b65e2.vps.ovh.net:1880/webcam/skyline?src=/italia/piemonte/cuneo/artesina-mondole-ski.html?w=153&referrer=https://www.artesina.it/"},
								{ name: "Mirafiori", type: "image", src: "https://www.simolimo.com/webcam/artesina/mirafiori/image.jpg"},
								{ name: "Frabosa Malanotte", type: "image", src: "https://www.frabosaski.it/assets/img/webcam/malanotte.jpg"},
								{ name: "Frabosa", type: "image", src: "https://www.frabosaski.it/assets/img/webcam/frabosa01.jpg"}
							]},
						"sanGiacomo" : {
							name: "San Giacomo", webcams: [ 
								{ name: "Alpet", type: "hls", src: "http://vps-bc4b65e2.vps.ovh.net:1880/webcam/skyline?src=/italia/piemonte/cuneo/monte-alpet.html?w=3766&referrer=https://www.sangiacomocardiniski.com/"},
								{ name: "Alpet Panorama", type: "hls", src: "https://cdn-005.whatsupcams.com/hls/it_roburent01.m3u8"},
								{ name: "Cardini", type: "hls", src: "https://cdn-007.whatsupcams.com/hls/it_roburent03.m3u8"}
							]},
						"stgree" : {
							name: "StGree", webcams: [ 
								{ name: "Valle", type: "image", src: "https://www.stgree.net/camera/2"},
								{ name: "Seggiovia", type: "image", src: "https://www.stgree.net/camera/3"},
								{ name: "Pista Nera", type: "image", src: "https://www.stgree.net/camera/4"},
								{ name: "Pian del Bal", type: "image", src: "https://www.stgree.net/camera/6"},
								{ name: "Vetta", type: "image", src: "https://www.stgree.net/camera/0"}
							]},
						"limone" : {
							name: "Limone", webcams: [ 
								{ name: "Niculin", type: "image", src: "https://cdn.riservabianca.it/webcams/niculin_2.jpg"},
								{ name: "Cabanaira", type: "image", src: "https://cdn.riservabianca.it/webcams/cabanaira_0.jpg"},
								{ name: "Alpetta", type: "image", src: "https://cdn.riservabianca.it/webcams/cabinovia-monte-vs-alpetta_0.jpg"}
							]},
						"prali" : {
							name: "Prali", webcams: [ 
								{ name: "Malzat", type: "image", src: "https://www.praliskiarea.info/webcam/malzat.jpg"},
								{ name: "Capannina", type: "image", src: "https://www.praliskiarea.info/webcam/capannina.jpg"},
								{ name: "Bric Rond", type: "image", src: "https://www.praliskiarea.info/webcam/bricrond.jpg"}
							]},
						"vario" : {
							name: "Vario", webcams: [
								{ name: "Val Maira Acceglio", type: "image", src: "https://www.lemarmotte.com/webcam/webcam_online/webcam.jpg" },
								{ name: "Entracque Paese", type: "image", src: "http://www.servizipubblicaamministrazione.it/cms/portals/104/SiscomArchivio/Webcam/entracque.jpg"}
							]}
				}},
				"lombardia": {
					name: "Lombardia", locations: {
						"colere" : {
							name: "Colere", webcams: [ 
								{ name: "Cima Bianca", type: "image", src: "https://www.furaco.it/webcam/colere/cimabianca/cimabianca.jpg"},
								{ name: "Polzone", type: "image", src: "https://www.furaco.it/webcam/colere/polzone/polzone.jpg"},
								{ name: "Carbonera", type: "image", src: "http://www.maxpiantoni.it/images/stories/miawebcam/cam.jpg"}					
						]},
						"stelvio" : {
							name: "Stelvio", webcams: [
								{ name: "Livrio", type: "image", src: "https://jpeg.popso.it/webcam/webcam_online/stelviolive_10.jpg"},
								{ name: "Trincerone", type: "image", src: "https://jpeg.popso.it/webcam/webcam_online/stelviolive_09.jpg"},
								{ name: "Trincerone", type: "image", src: "https://jpeg.popso.it/webcam/webcam_online/stelviolive_08.jpg"},
								{ name: "Passo Stelvio", type: "image", src: "https://jpeg.popso.it/webcam/webcam_online/stelviolive_03.jpg"},
								{ name: "Passo Stelvio", type: "image", src:"https://jpeg.popso.it/webcam/webcam_online/stelviolive_07.jpg"}
						]},
						"bormio" : {
							name: "Bormio", webcams: [ 
								{ name: "Bormio 2000", type: "iframe", src: "https://webtv.feratel.com/webtv/?cam=6220&design=v5&lg=it"},
								{ name: "Bormio 3000", type: "iframe", src: "https://webtv.feratel.com/webtv/?cam=6221&design=v5&lg=it"}									
						]},
				}},				
				"trentino" : {
					name: "Trentino", locations: {
						"sanpellegrino" : {
							name: "San Pellegrino", webcams: [ 
								{ name: "San Pellegrino", type: "iframe", src: "https://4k.meteocam.it/cimauomo/"},	
								{ name: "Col Margherita", type: "iframe", src: "https://4k.realcam.it/pano19/"}
						]},
						"valgardena" : {
							name: "Val Gardena", webcams: [
								{ name: "Val Gardena", type: "iframe", src: "https://webtv.feratel.com/webtv/?cam=6340&design=v5&lg=it"}
						]}
					}
				},
				"liguria" : {
					name: "Liguria", locations: {		
						"santoStefano" : {
							name: "Santo Stefano D'Aveto", webcams: [ 
								{ name: "Prato Cipolla", type: "image", src: "https://retelimet.centrometeoligure.it/stazioni/meteo-cipolla/webcam/current.jpg"},
								{ name: "Monte Bue", type: "image", src: "http://www.webcam.pc.it/webcam/montebue.jpg"},
								{ name: "Rocca D'Aveto", type: "image", src: "https://retelimet.centrometeoligure.it/stazioni/meteo-rocca/rocca.jpg"}								
							]},
						"genova" : {
							name: "Genova", webcams: [ 
								{ name: "Apparizione", type: "image", src: "http://apparizionemeteo.altervista.org/images/cameracam1/cam.jpg"},					
								{ name: "Lanterna", type: "image", src: "https://smart.comune.genova.it/webcam2/tursi/current.jpg"},
								{ name: "Nervi", type: "image", src: "https://smart.comune.genova.it/webcam2/nervi/current.jpg"},
								{ name: "Sant'Ilario", type: "image", src: "https://smart.comune.genova.it/webcam2/s_ilario/current.jpg"},
								{ name: "Torre Gropallo", type: "image", src: "https://smart.comune.genova.it/webcam2/gropallo/current.jpg"},
								{ name: "Terrazza Colombo - Levante", type: "iframe", src: "https://g0.ipcamlive.com/player/player.php?alias=6286693e4e708&skin=white&autoplay=1"},
								{ name: "Terrazza Colombo - Centro", type: "iframe", src: "https://g0.ipcamlive.com/player/player.php?alias=6166ebad0c2a0&skin=white&autoplay=1"},
								{ name: "Terrazza Colombo - Ponente", type: "iframe", src: "https://g0.ipcamlive.com/player/player.php?alias=6166eb417160c&skin=white&autoplay=1"},
								{ name: "Terrazza Colombo - Mare", type: "iframe", src: "https://g0.ipcamlive.com/player/player.php?alias=616694726ad6a&skin=white&autoplay=1"}						
							]},
						"monti" : {
							name: "Monti", webcams: [
								{ name: "Monte Caucaso", type: "image", src: "https://www.tripwebcam.com/webcam-live/rifugiocaucaso/cam.jpg"},
								{ name: "Rigugio Argentea", type: "hls", src: "https://s64.ipcamlive.com/streams/40e9td2frcyx08fnw/stream.m3u8"},
								{ name: "Beigua", type: "image", src: "https://retelimet.centrometeoligure.it/stazioni/meteo-beigua/data/webcam/webcam.php"},
								{ name: "Rifugio Antola", type: "image", src: "https://retelimet.centrometeoligure.it/stazioni/meteo-rifugio-parco-antola/data/webcam/antolacam.jpg"},
								{ name: "Rifugio La Terza", type: "image", src: "https://www.tripwebcam.com/webcam-live/rifugiolaterza/cam.jpg"},
							]}	
					}
				}
			}
			
			function setParentHeight(iframePreview, height) {
				$("#" + iframePreview).parent().height(height);
			}
			
			function panoramaxIframe(iframePreview, instanceId, width) {
				var parent = $('#' + iframePreview).parent();
				$('#' + iframePreview).remove();
				$('<iframe>', { id:  iframePreview, class : "carouselIframe" }).appendTo(parent);		
				setParentHeight(iframePreview, width/2);
			    
				var codeToEmbed = "<script type=\"text/javascript\" src=\"https://static.panomax.com/front/thumbnail/js/pmaxthumbnail.js\"><" + "/script>\n";
				codeToEmbed += "<script type=\"text/javascript\">\n";
				codeToEmbed += "PmaxThumbnail.place({\"instance\":" + instanceId + ",\"width\":\"100%\",\"height\":" + width/2 + ",\"map\":false,\"instanceName\":false,\"timelapse\":false,\"weather\":false});\n";
				codeToEmbed += "<" + "/script>";

				const $iframeDocument = document.getElementById(iframePreview).contentWindow.document;			
				$iframeDocument.open();
				$iframeDocument.write('<style type="text/css">body { margin: 0; }</style>' + codeToEmbed);
				$iframeDocument.close();			
			}	
			
			function loadIframe(mainKey, key) {
				var width = $("#" + key).width();
				
				const location = locationList[mainKey].locations[key];	
				location.webcams.forEach((webcam, index) => {
					if(webcam.type == "iframe") {
						const iframeId = "iframePreview_" + key + index;
						if (webcam.iframeType === "panoramax") {
							panoramaxIframe(iframeId, webcam.iframeId, width);
						} else {
							setParentHeight(iframeId, width / 1.64);
						}
					}
				});	
			}
			
			//*****************************************************************************************
			//Clock functions
			function startTime() {
			  const now = new Date();
			  timeText = now.getDate() + "/" + padTime(now.getMonth() + 1) + "/" + now.getFullYear() + " ";
			  timeText += now.getHours() + ":" + padTime(now.getMinutes()) + ":" + padTime(now.getSeconds());
			  setTimeout(startTime, 1000);
			  showClock($(window).width());
			}

			function padTime(i) {
			  if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
			  return i;
			}
			
			function showClock(width) {
				const isWide = width >= 576;
				$("#clockLeft").toggle(!isWide).html(isWide ? "" : timeText);
				$("#clockRight").toggle(isWide).html(isWide ? timeText : "");
			}
			//*****************************************************************************************
			
			function createContainerElements(element) {	
				$("#mainContainer").empty();

				const [mainKey, key] = element.split("_");
				const location = locationList[mainKey].locations[key];	

				const $container = $('<div>', { id: key, class : "container mt-2" });
				const $carousel = $('<div>', { id: key + "Carousel", class : "carousel slide" });
				$("#mainContainer").append($container.append($('<h2>', { text: location.name }), $carousel ));
				
				const $carousel_indicators = $('<div>', { class : "carousel-indicators" });
				const $carousel_inner = $('<div>', { class : "carousel-inner" });
				const $btn_prev = $('<button>', { class : "carousel-control-prev", type: "button", "data-bs-target": "#" + key + "Carousel", "data-bs-slide": "prev" });
				const $btn_next = $('<button>', { class : "carousel-control-next", type: "button", "data-bs-target": "#" + key + "Carousel", "data-bs-slide": "next" });
				$btn_prev.append($('<span>', { class : "carousel-control-prev-icon", "aria-hidden": true }), $('<span>', { class : "visually-hidden", text: "Previous" }));
				$btn_next.append($('<span>', { class : "carousel-control-next-icon", "aria-hidden": true }), $('<span>', { class : "visually-hidden", text: "Next" }));
				$carousel.append($carousel_indicators, $carousel_inner, $btn_prev, $btn_next); 
				
				for(var i = 0; i <location.webcams.length; i++) {
					const entry = location.webcams[i];
					$carousel_indicators.append($('<button>', { type: "button", "data-bs-target": "#" + key + "Carousel", "ata-bs-targe": "#" + key + "Carousel", "data-bs-slide-to": i, "aria-label": "Slide " + (i+1) }));
					
					const $el = $('<div>', { class: "carousel-item" });
					if(entry.type == "image") {
						//Add Image
						$el.append($('<img>', { class: "NO-CACHE carouselImg", src: entry.src + "?a=" + Math.random(), alt: entry.name }));
					}
					else if(entry.type == "hls") {
						const $video = $('<video>', { class : "carouselImg" })
						if (Hls.isSupported()) {
							const hls = new Hls();
							hls.loadSource(entry.src);
							hls.attachMedia($video[0]);
							hls.on(Hls.Events.MANIFEST_PARSED, () => {
							  $video[0].play();
							});
						} else if ($video.canPlayType('application/vnd.apple.mpegurl')) {
							// For Safari
							$video.src = entry.src;
							$video.addEventListener('loadedmetadata', () => {
							  $video.play();
							});
						}
						$el.append($video);
					}
					else if(entry.type == "iframe") {
						//Add Iframe
						const $iframe = $('<iframe>', { class : "carouselIframe", id: "iframePreview_" + key + i })
						if(entry.src) {
							$iframe.attr('src', entry.src);
						}
						$el.append($iframe);
					}
					$el.append($('<div>', { class: "carousel-caption" }).append($('<h3>', { text: entry.name })));
					$carousel_inner.append($el);
				}
				
				$carousel_inner.find(">:first-child").toggleClass("active");
				$carousel_indicators.find(">:first-child").toggleClass("active");
				$carousel_indicators.find(">:first-child").attr("aria-current", true);
				
				loadIframe(mainKey, key);
			}
			
			function createMenuElements() {
				const $navbarList = $("#navbar-list").empty();
				Object.entries(locationList).forEach(([mainKey, mainVal]) => {
					const $li = $('<li>', { class: "nav-item dropdown" });
					const $dropdown = $('<a>', {
						class: "nav-link dropdown-toggle",
						href: "#" + mainKey,
						id: "navbarDropdown_" + mainKey,
						role: "button",
						"data-bs-toggle": "dropdown",
						"aria-expanded": "false",
						text: mainVal.name
					});
					const $menu = $('<div>', {
						class: "dropdown-menu",
						"aria-labelledby": "navbarDropdown_" + mainKey
					});
					Object.entries(mainVal.locations).forEach(([subKey, subVal]) => {
						$menu.append($('<a>', {
							class: "dropdown-item",
							href: "#" + mainKey + "_" + subKey,
							text: subVal.name,
							"data-main": mainKey,
							"data-sub": subKey
						}));
					});
					$li.append($dropdown, $menu);
					$navbarList.append($li);
				});
				$("#navbar-list .dropdown-menu:first .dropdown-item:first").addClass("active");
			}
			
			//Entry point
			$(document).ready(function() {
				startTime();
				createMenuElements();
				
				 // Show first location by default
				const $firstActive = $(".nav-item a.active");
				if ($firstActive.length) {
					createContainerElements($firstActive.attr("href").substring(1));
				}

				// Handle menu clicks
				$('#navbar-list').on('click', '.dropdown-menu a', function(e) {
					e.preventDefault();
					$(".dropdown-menu a").removeClass("active");
					$(this).addClass("active");
					createContainerElements($(this).attr("href").substring(1));
				});

				// Handle window resize
				$(window).on("resize", function() {
					const $active = $(".nav-item a.active");
					if ($active.length) {
						createContainerElements($active.attr("href").substring(1));
					}
					showClock($(window).width());
				});
			});		
	  </script>
	
	  <!-- Styles -->
	  <style>
		.carousel-inner {
			border-width: 1px 1px 0px 1px;
			border-style: solid;
		}
	  
		.carousel-item {
			height: auto;
			max-height: calc(100vh - 150px);
		}
		
		.carousel-indicators {
			background-color: black;
			opacity: 0.75;
			width: calc(100% + 30px);
			margin-left: -15px;
			margin-right: -15px;
			margin-bottom: 0;
			bottom: -23px;
		}
		
		.carousel-control-prev,
		.carousel-control-next {
			width: 15px;
			background-color: black;
			opacity: 0.75;
		}
		
		.carousel-control-next:focus, 
		.carousel-control-next:hover, 
		.carousel-control-prev:focus, 
		.carousel-control-prev:hover {
			opacity: 0.75;
		}
		
		.carousel-control-prev {
			left: -15px;
		}
		
		.carousel-control-next {
			right: -15px;
		}
		
		.carousel-caption {
			background-color: black;
			opacity: 0.75;
			bottom: 0;
			left: 0;
			right: auto;
			margin-bottom: 0;
			padding: 0px 5px;
		}
		
		.carousel-caption h3 {
			margin-bottom: 0;
		}
		
		.carouselIframe {
			width: 100%;
			height: 100%;
		}
		
		.carouselImg { 
			width: 100%;
			height: 100%;
			object-fit: contain;
			object-position: 50% 50%;
		}
		
		.clock {
			color: white;
			margin-left: auto;
			margin-right: 5px;
		}

		.dropdown-item.active, .dropdown-item:active {
			background-color: black !important; /* Bootstrap primary, change as needed */
		}
	  </style>
	</head>
	<body>
		<nav class="navbar navbar-expand-sm navbar-dark bg-dark">
			<div class="container-fluid">
				<a class="navbar-brand" href="javascript:void(0)"><i class="bi bi-camera2"></i></a>
				<div class="clock" id="clockLeft"></div>
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mynavbar">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="mynavbar">
					<ul id="navbar-list" class="navbar-nav me-auto"></ul>
				</div>
				<div class="clock" id="clockRight"></div>
			</div>
		</nav>
		<div id="mainContainer"></div>
	</body>
</html>
